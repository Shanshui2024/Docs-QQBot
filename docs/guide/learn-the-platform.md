---
title: 使用开放平台
sidebar_position: 2
---

:::danger 本页暂无图片
慢点来慢点来，设备不在手边，写起来比较费劲，还望多多谅解喵

♡=•ㅅ＜=)
:::
# 使用QQ开放平台

## 先决条件
- 一个可用的[开发者账户](./create-an-account)
- 一个可用的[机器人](./create-a-bot)

## 登录
通过 [QQ开放平台](httpd://q.qq.com/) 登录开发者账户，并选定您的机器人

:::warning 注意
由于开平**未适配**手机端，手机端页面无法正常显示，因此本处不推荐使用手机进行操作
:::

## 工作流
根据开平机器人首页，我们可以看到其被分为三部分

即：资料、机器人开发和上线

接下来，我们会按照该顺序逐级介绍相关功能。

## 资料
除了在 **创建期间** 可以编辑机器人资料外，我们还可以点击 `首页 > 资料` 或左侧边栏的 `账号设置` 一栏对相关资料进行调整。
### 基础信息
需要注意的是，**每个机器人每月仅可修改五次基础信息**，请仔细斟酌后再进行修改。

点击“修改”按钮后，会弹出一个验证窗口，请使用管理员QQ进行扫码验证。

截至目前，可修改的基础信息有名称，头像和介绍。在修改时，请遵守官方规则，例如：
- 机器人名称允许2-30个字符，一个中文=两个字符。
- 机器人名称需遵守 [运营规范](https://bot.q.qq.com/wiki/business) （控制台的文档链接“命名规范”已废弃）
- 机器人头像不允许摄政和色情等
- 机器人头像建议使用 `.png` 格式不超过2M，尺寸建议为144px × 144px
- 机器人介绍信息不允许摄政等

完毕后，请点击完成修改并 **再次扫码验证** 。随后即可等待其通过修改

:::warning 
如果编辑资料后被开放平台打回，请检查自己提交的资料是否存在摄政等问题，毕竟是否打回取决于开平审核
::: 

### 账号信息
本组件不可修改，其中的AppID为您的机器人ID（**不是机器人QQ号**），我们也可以在 `管理 > 开发管理` 或 `开发 > 开发管理` 里看到AppID。

登录邮箱则为该账号的邮箱

### 隐私协议
隐私协议是开放平台在 **2024年5月22日** 开始要求的新功能，旨在督促开发者遵守法律法规，确保机器人合规性、安全性。

更多规定详见：
- [【重要】机器人隐私协议上传通知](https://pd.qq.com/s/nag48mp5?b=2)

### 聊天背景素材设置
本组件允许开发者在单聊页面自定义 **简介页面** 的背景图，对于机器人介绍页面很有用

:::warning 注意
开放平台的表述实际上有误，**“聊天背景素材”** 实际上与聊天背景没有任何关系。
::: 

允许上传的图片格式为 `.png` 或 `.jpg` ，尺寸 `720*1280` ，可分别设定日间和夜间的背景图，完毕后点击 `保存` 按钮并使用管理员QQ进行验证。

例如在本处，我们使用AI生成的背景图填入机器人的两种背景图并保存提审。这样，就可以在机器人简介页面看到了。

### 开场白设置
此处可修改群聊和私聊开场白，当机器人被添加进群聊或被用户添加进聊天时，将会自动发送开场白信息。

当然，由于开放平台也有加群推送的通知，所以群聊/私聊开场白信息也可通过事件判断进行推送，具体内容我们会在开发中详解。

特别的，对于 **私聊开场白** ，开放平台还存在 **自定义对话建议** 一栏，当用户进行聊天时，会自动弹出聊天建议。

### 功能介绍素材设置
本处上传的图片可以展示出对应功能的返回内容，下图为 [幽幽子](https://bot.yunmengdu.cn) 的官Bot页面。

对于此处内容，具体要求见 [机器人资料卡 配置指引](https://docs.qq.com/doc/DY3pBQkx1Y25SblpB?_t=1771320461841&nlc=1) 

### 机器人官方频道跳转
此处可配置简介页面的频道跳转，具体功能状态等详见 [机器人资料卡 配置指引](https://docs.qq.com/doc/DY0ZLbWtldU1sZGN5) 

### 其他
除了上述内容外，页面内还有 **频道用户意见反馈** 和 **产品ID填写** 。 具体操作要求见管理端控制台。

## 机器人开发

本节内容，我们将会详细解释机器人开发相关部分，同时，该部分也是 **最为重要的部分** ，希望各位能多多阅读这些内容～

:::danger `（｀Δ´）！`
前面的内容涉及到亲自开发、其他机器人框架接入和其他注意事项，必要的地方会用 **加粗** 标注
:::

本节共分为五个内容：沙箱配置、功能配置、高阶能力、开发管理、回调配置。

### 沙箱配置
按照开平的说法，沙箱环境是正式上线前的测试环境，在沙箱中指定的QQ群、消息列表、频道和频道私信可以在机器人正式上线前先进行功能预览。

对于**部分框架适配器**，可能会有一个 **“沙箱模式”** 的开关。在测试环境下启用，但如果在 **上线前提交审核** ，请 **关闭框架适配器的沙箱模式** 。

添加沙箱配置时，如果没有你想添加的成员，可以点击侧边栏 `管理 > 成员管理`  后，在弹出的页面中找到 **添加成员** ，输入指定成员的QQ号、点击 **“搜索用户”** 按钮，然后选择指定成员，分配 **开发设置** 权限并保存。

这样，就可以选定私聊和频道私信成员了。

**QQ群和QQ频道** 列表只取决于当前登录的管理员账户的**群/频道列表**，需要注意的是，只有 **人数≤20人 且 管理员QQ为群主/群管/频道主/频道管理** 才可以被添加进指定群聊。

特别的，对于QQ频道，还存在 **机器人类型** 的区分，为 公域 和 私域 机器人。


### 沙箱配置 - 机器人类型
#### 私域机器人
私域机器人仅允许加入 由管理员QQ创建的 频道，无法被其他频道检索并加入。

（当然，频道限制不包括平台的官方频道和官方测试频道的添加）

不过需要注意的是，私域机器人的 **频道请求接口** 与 公域的 **频道请求接口** 不一致，具体文档如下
- [QQ公、私域机器人能力开放计划](https://doc.weixin.qq.com/doc/w3_m_SgnABcmAnWTK?scode=AJEAIQdfAAo8l5jUdwAIMA9waBACc)
- [私域流量机器人定向开放接口开发文档](https://doc.weixin.qq.com/doc/w3_AaEAbQaSAI01prhM2YcToOiM60IZv?scode=AJEAIQdfAAosSMAvupAaEAbQaSAI0)

#### 公域机器人
公域机器人允许被其他频道搜索、添加和推荐，不取决于管理员状态，只取决于是否正式上线。

在以往的平台规定中，私域机器人有100条/频道/天的 **主动消息** ，而公域只有2条/频道/天的 **主动消息** ，但开平已经于 **2025年4月21日 关闭了主动消息接口**。

:::tip 主动消息是什么？
主动消息，官方定义是：不依赖其他事件而发送的消息，范围涵盖几乎所有发送消息（不包括表情表态）。但只有4条/群/月，通常用于推送更新提示（例如 [幽幽子](https://bot.yunmengdu.cn) ）。

需要注意的是，**主动消息已经被停用，详见 [【关于QQ机器人消息推送调整策略通知】](https://q.qq.com/miniapp#/news/detail/974e66a946a5e54c441ca983585a7aab)** 。
:::

### 功能配置
功能配置分为三部分，有 服务、指令和快捷菜单。
:::warning 注意
**服务** 一栏没有具体进行测试，官方占位符也没有进行实验，本处内容可能并不准确。
:::

服务，可接入对应的小程序并附带请求参数，例如QQ频道、私聊和频道私聊等占位符。

***据传：** 小程序路径是开发小程序时的代码文件目录*

指令，可配置机器人在不同聊天环境下的命令菜单，可配置权限范围等等。

需要注意的是，**群聊/频道**下 激活机器人命令需要 **艾特机器人** 

快捷菜单，显示在QQ私聊列表栏中，可以添加 **服务** 和 **指令**，规定与上文一致

### 高阶能力
高阶能力分为 **消息模板** 和 **在消息列表添加机器人**

前者可申请开通被动markdown使用权限和被动json按钮使用权限；后者可允许私聊并且被用户添加为“好友”

点按 **Markdown模板** 下方的 **开通** 按钮，会跳转到腾讯问卷，请按实情填写机器人的相关信息，例如AppID等。

需要注意的是，高阶能力申请通常需要 **半个月到一个月** 的时间，对于Markdown的具体用法以及提审规范，详见
- [【Markdown功能调整、模板提审规则说明】](https://pd.qq.com/s/1axvyp4e7?b=2)

### 开发管理
开发管理页面中展示了机器人的具体接入信息，

#### 开发信息
第一个模块展示了 **极其重要的** 开发信息，即 `QQ号` `AppID` `Token（令牌）` `AppSecret（密钥）`

需要注意的是，重置/生成后两者参数需要验证 **管理员QQ**，分配的所有 **成员（哪怕开了所有权限）** 也无法进行上述操作。

#### 网页授权回调地址
本处在跳转 `h5` 需要 `Oauth` 的时候可以使用（如果机器人服务是跳转小程序的，可忽略此处配置）

#### 消息URL配置
:::danger 注意
开平控制台对消息url配置的审批要求已经更改，建议以本处操作为准
:::
如果需要让机器人发送类似 `服务条款` 或相关链接，需要在此处配置url白名单。

例如，在 [AxT机器人](https://docs.axtn.net/axtbot/v2.1/guide/intro.html) 中，当将机器人拉入群聊时，会主动推送入群信息 例如 
```
欢迎使用AxT社区机器人2.1.0
===============
| 在开始之前，请务必阅读以下协议和用户政策。
| 继续使用机器人，即代表您同意将当前聊天环境对机器人的用户数据、信息等上报给AxT进行数据分析。
| 请注意：AxT将不会对用户数据进行任何的修改、公开、分享、出售、转让，仅用于分析用户数据，并生成报告等。
| 有关于隐私数据的使用：由于QQ开放平台限制，用户隐私仅包含您上传的富文本和文本信息。
| 如果您对此有任何异议，请联系admin@axtrk.com。
===============
| 服务条款：https://www.axtrk.com/terms
```

其中， `https://www.axtrk.com/terms` 就是一个链接，而 **事实上** `admin@axtrk.com` 中的 `axtrk.com` **也是一个链接**

需要注意的是，这两个链接 **不等价**，并且开放平台申请的url **不允许通配符**

<details>
<summary>有关通配符……</summary>

通配符，就是通用的标识符。

例如，`*.baidu.com` 指代所有后缀为 `.baidu.com` 的域名，例如 `pic.baidu.com` `fanyi.baidu.com` 或者不存在的 `img.baidu.com` 都符合这一规则

同时，开放平台为防止这种域名规则被滥用，禁用了这种通配符规则。

</details>

若需发送域名，请准备：
- 一个备案域名
- 校验文件
- 一个邮箱

点按开平控制台显示的“下载校验文件”，以下载一个 `.json` 结尾的文件`

**或者**手动创建一个`appid.json`，`appid`处填入您自己机器人的appid
例如：机器人的appid为 `102047291`，则创建一个名为 `102047291.json` 的文件并在里面填入以下内容
```
{"bot_appid":您自己机器人的appid，例如102047291}
```

然后将其放置在指定域名的**根目录**，确保访问该地址可以打开此校验文件。

例如：`www.axtrk.com/102047291.json`

然后，发送url加白申请邮件，模板如下：
```
邮箱地址：QQ_BOT_API@tencent.com
邮件主题：申请事项
邮件内容— — — — — — — — — —
bot id：
机器人功能说明：
机器人主体名称：（注册时绑定的主体信息 请写实际名字）
申请事项：
使用场景：
承诺业务将严格遵守 QQ 机器人平台的运营规范，如果有违反，一切后果由业务使用侧自行承担。
承诺方：（注册时绑定的主体信息 请填写实际名字）
```
等待申请通过后，域名就可以在开平控制台被添加了。

需要注意的是，单一链接只能严格对应单一链接，无法在配置`example.com`的情况下发送 `example.com/xxx`，且只允许 `https://` 头。

### 回调配置
此处配置的是信息推送地址，用于 **WebHook链路信息推送**

<details>
<summary>有关WebHook……</summary>

WebHook，就是开放平台服务端接收到信息后，向指定的 **WebHook地址** 推送事件信息。接收端需要进行相关事件处理。

</details>

:::danger 慎用WebHook
开放平台通知：websocket 事件推送链路已于**24年年底前**逐步下线，后续官方不再维护。已接入websocket链路的机器人，请迁移至webhook链路。

目前状况未知，如果有仍在使用websocket链路的机器人，请在 **配置好WebHook接收端** 或 **有备用容灾** 的机制后，再配置，否则 **一旦配置好WebHook链路，WebSocket会立即下线并不再可用**
:::

#### 请求地址
请求地址即为 **WebHook** 的回调地址，对于部分成熟的框架如Koishi，会有专门的路径配置，只需暴露到公网即可解决。

需要注意的是，**WebHook**地址需要确保占用以下 **任一端口**：

80, 443, 8080, 8443

四选一即可，请确保 **对应HTTPS证书未过期并与指定域名一致**

（AxTBot上线期间出现过 **掉证书后收不到消息** 的问题，所以建议各位配置证书流水线之类的以降低配置成本）

填入地址后，点击页面上空白的地方，开放平台会发送相关的校验数据，如果通过了，则右侧的 **“确定配置”** 按钮就会亮起，否则会出现诸如 **签名校验失败** 和 **校验失败** 的提示。

有关于更多技术细节，请转到开发一节

#### 添加事件
在连接配置下方，有不同的事件类型

通常来讲，需要哪些事件，就可以进行勾选并点击右下角的“确定配置”

需要注意的是，事件处理似乎只影响 **WebHook** 权限

有关更多技术细节，请转到开发一节

## 上线
对现有机器人上线，即应用当前的所有设置并灰度到整个平台。

需要注意：上线之前需要完成前文所述的 **所有操作** ，包括 **基础信息配置**，**配置命令**，**提交其他所有申请**，然后我们转到侧边栏 `管理 > 发布上架` 部分，下载模板并按需填写 **自测报告**，填写指定部分后上传，并按下 **提交审核** 按钮，等待 **审批结束后**，该页面的按钮变为 **上线** 后点击上线，即完成机器人功能的灰度上线。

注意：审核期间请 **关闭** 框架的沙盒模式，并保持机器人框架在线。

通常而言，机器人被退回会有相关提示，通过 **站内信** 方式通知。建议各位不定期上线检查。